<mvc:View
    controllerName="com.inetum.missolicitudes.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:m="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:table="sap.ui.table"
    xmlns:html="http://www.w3.org/1999/xhtml"
    height="100%"
>
    <Page
        id="misSolicitudesPage"
        title=""
        showNavButton="false"
        >
        <customHeader>
            <Toolbar>
                <core:Icon 
                    src="sap-icon://task" 
                    size="1.5rem" 
                    class="sapUiNoMarginEnd sapUiMediumMarginBegin"/>
                <Title 
                    text="{i18n>misSolicitudesTitle}" 
                    level="H2"/>
            </Toolbar>
        </customHeader>

        <content>       
            <Panel
                class="sapUiMediumMarginBottom"
                headerText=""
                >

                <content>
                    <!-- Tabla principal de solicitudes -->
                    <table:Table
                        id="idRequestTable"
                        rows="{solicitudes>/solicitudes/results}"
                        selectionMode="None"
                        enableSelectAll="true"
                        ariaLabelledBy="tableTitle"                        
                        alternateRowColors="false"
                        columnHeaderVisible="true"
                        enableColumnReordering="true"
                        showNoData="true"
                        threshold="100"                       
                        visibleRowCount="15"
                        enableBusyIndicator="true"
                        enableCellFilter="true"
                        class="sapUiResponsiveMargin" >

                        <table:extension>
                            <OverflowToolbar style="Clear">
                                <SearchField
                                    id="searchField"
                                    placeholder="{i18n>searchPlaceholder}"
                                    liveChange="onSearch"
                                    value="{mLocalModel>/globalFilter}"
                                    width="15rem"/>                           
                                <ToolbarSpacer/>
                                <Title 
                                    id="recordCount"
                                    text="{= ${solicitudes>/solicitudes/totalCount} === 1 
                                            ? ${solicitudes>/solicitudes/totalCount} + ' ' + ${i18n>singleRecord}
                                            : ${solicitudes>/solicitudes/totalCount} + ' ' + ${i18n>totalRecords}
                                          }"
                                    titleStyle="H5"/>
                            </OverflowToolbar>
                        </table:extension>                          
                        

                        <table:columns>
                            <!-- Columna: Solicitud -->
                            <table:Column
                                width="30%"
                                sortProperty="cust_nombreSol"
                                filterProperty="cust_nombreSol"
                                showFilterMenuEntry="true"
                                showSortMenuEntry="true"
                            >
                                <table:label>
                                    <Label
                                        text="{i18n>solicitud}"
                                        wrapping="true"
                                    />
                                </table:label>
                                <table:template>                                       
                                        <Text
                                        text="{solicitudes>cust_nombreSol}"
                                        wrapping="true"
                                    />
                                </table:template>
                            </table:Column>

                            <!-- Columna: Tipo de Solicitud -->
                            <table:Column
                                width="20%"
                                sortProperty="cust_nombreTSol"
                                filterProperty="cust_nombreTSol"
                                showFilterMenuEntry="true"
                                showSortMenuEntry="true"
                            >
                                <table:label>
                                    <Label text="{i18n>tipoSolicitud}" wrapping="true"/>
                                </table:label>
                                <table:template>
                                    <Text
                                        text="{solicitudes>cust_nombreTSol}"
                                        wrapping="true"
                                    />
                                </table:template>
                            </table:Column>

                            <!-- Columna: Fecha de Solicitud -->
                            <table:Column
                                width="15%"
                                sortProperty="cust_fechaSol"
                                filterProperty="cust_fechaSol"
                                showFilterMenuEntry="true"
                                showSortMenuEntry="true"
                                hAlign="Center"
                            >
                                <table:label>
                                    <Label
                                        text="{i18n>fechaSolicitud}"
                                        wrapping="true"
                                    />
                                </table:label>
                                <table:template>                                        
                                        <Text text="{path: 'solicitudes>cust_fechaSol', formatter: '.formatter.formatDateToYYYYMMDD'}" />                                        
                                </table:template>
                            </table:Column>

                            <!-- Columna: Estado -->
                            <table:Column
                                width="15%"
                                sortProperty="cust_status"
                                filterProperty="cust_status"
                                showFilterMenuEntry="true"
                                showSortMenuEntry="true"
                            >
                                <table:label>
                                    <Label
                                        text="{i18n>estado}"
                                        wrapping="true"
                                    />
                                </table:label>
                                <table:template>
                                    <ObjectStatus
                                        text="{solicitudes>cust_status}"
                                        state="{
                                                    path: 'solicitudes>cust_status',
                                                    formatter: '.formatter.formatStatusState'
                                                }"
                                        icon="{
                                                    path: 'solicitudes>cust_status',
                                                    formatter: '.formatter.formatStatusIcon'
                                                }"
                                    />
                                </table:template>
                            </table:Column>

                            <!-- Columna: Acciones -->
                            <table:Column
                                width="10%"
                                hAlign="Center"
                                showFilterMenuEntry="false"
                                showSortMenuEntry="false"
                            >
                                <table:label>
                                    <Label
                                        text="Visualizar"
                                        wrapping="true"
                                    />
                                </table:label>
                                <table:template>
                                    <!-- Botón Visualizar -->
                                    <Button
                                        icon="sap-icon://display"
                                        tooltip="{i18n>visualizar}"
                                        press="onVisualizarPress"
                                        type="Transparent"
                                        class="sapUiTinyMarginEnd"
                                    />
                                </table:template>
                            </table:Column>

                            <table:Column
                                width="10%"
                                hAlign="Center"
                                showFilterMenuEntry="true"
                                showSortMenuEntry="true"
                            >
                                <table:label>
                                    <Label text="Cancelar" wrapping="true"/>
                                </table:label>
                                <table:template>
                                    <!-- Botón Cancelar (solo si está en curso) -->
                                    <Button
                                        icon="sap-icon://decline"
                                        tooltip="{i18n>cancelar}"
                                        press="onCancelarPress"
                                        type="Reject"
                                        visible="{
                                                    path: 'solicitudes>cust_status',
                                                    formatter: '.formatter.isStatusEnCurso'
                                                }"
                                    />
                                </table:template>
                            </table:Column>
                        </table:columns>
                    </table:Table>                       
                </content>
            </Panel>
        </content>
    </Page>
</mvc:View>