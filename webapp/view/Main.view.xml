<mvc:View
    controllerName="com.inetum.missolicitudes.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:m="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:table="sap.ui.table"
    xmlns:html="http://www.w3.org/1999/xhtml"
    height="100%"
>
    <Page
        id="misSolicitudesPage"
        title=""
        showNavButton="false"
    >
        <content>       
            <!-- <VBox class="sapUiSmallMargin" alignItems="Center"> -->
            <Panel
                class="sapUiMediumMarginBottom"
                headerText="" > <!-- Fata agregar el tamaño width="800px" -->

                <headerToolbar>
                    <Toolbar class="sapMTBTransparent-CTX">
                        <content>
                            <HBox alignItems="Center">
                                <core:Icon
                                    src="sap-icon://task"
                                    size="1.525rem"
                                    color="#0070f2"
                                    class="sapUiSmallMarginEnd" />
                                <Title
                                    text="{config>/titulo2}"
                                    level="H4" />
                            </HBox>
                        </content>
                    </Toolbar>
                </headerToolbar>

                <content>
                    <VBox class="sapUiMediumMargin">
                        <!-- Toolbar con controles superiores -->
                        <Toolbar class="sapUiMediumMarginBottom">
                            <content>
                                <!-- Búsqueda global -->
                                <SearchField
                                    id="searchField"
                                    placeholder="{i18n>searchPlaceholder}"
                                    search="onSearch"
                                    width="300px"
                                    class="sapUiMediumMarginEnd"
                                />

                                <ToolbarSpacer />

                                <!-- Contador de registros -->
                                <Text
                                    id="recordCount"
                                    text="{solicitudes>/solicitudes/totalCount} {i18n>totalRecords}"
                                    class="sapUiMediumMarginEnd"
                                />
                            </content>
                        </Toolbar>

                        <!-- Tabla principal de solicitudes -->
                        <table:Table
                            id="solicitudesTable"
                            rows="{path: 'solicitudes>/solicitudes/results', sorter: {path: 'cust_fechaSol', descending: false}}"
                            firstVisibleRow="0"
                            selectionMode="Single"
                            enableColumnReordering="true"
                            enableColumnFreeze="false"
                            enableSelectAll="false"
                            rowSelectionChange="onRowSelectionChange"
                            class="sapUiMediumMarginTop"
                            width="100%"
                            xmlns:table="sap.ui.table"
                            noData="{i18n>notDataFound}">
   
                            <table:columns>
                                <!-- Columna: Solicitud -->
                                <table:Column
                                    width="30%"
                                    sortProperty="cust_nombreSol"
                                    filterProperty="cust_nombreSol"
                                    showFilterMenuEntry="true"
                                    showSortMenuEntry="true"
                                >
                                    <table:label>
                                        <Label
                                            text="{i18n>solicitud}"
                                            wrapping="true"
                                        />
                                    </table:label>
                                    <table:template>
                                        <VBox class="sapUiSmallMargin">
                                            <FormattedText
                                                htmlText="&lt;strong&gt;{solicitudes>cust_nombreSol}&lt;/strong&gt;"
                                            />
                                            <ObjectStatus
                                                text="ID: {solicitudes>idSolicitud}"
                                                state="Information"
                                                class="sapUiTinyMarginTop"
                                            />
                                        </VBox>
                                    </table:template>
                                </table:Column>

                                <!-- Columna: Tipo de Solicitud -->
                                <table:Column
                                    width="20%"
                                    sortProperty="cust_nombreTSol"
                                    filterProperty="cust_nombreTSol"
                                    showFilterMenuEntry="true"
                                    showSortMenuEntry="true"
                                >
                                    <table:label>
                                        <Label text="{i18n>tipoSolicitud}" />
                                    </table:label>
                                    <table:template>
                                        <!-- <VBox class="sapUiSmallMargin"> -->
                                        <Text
                                            text="{solicitudes>cust_nombreTSol}"
                                            wrapping="true"
                                        />
                                        <!-- </VBox> -->
                                    </table:template>
                                </table:Column>

                                <!-- Columna: Fecha de Solicitud -->
                                <table:Column
                                    width="20%"
                                    sortProperty="cust_fechaSol"
                                    filterProperty="cust_fechaSol"
                                    showFilterMenuEntry="true"
                                    showSortMenuEntry="true"
                                >
                                    <table:label>
                                        <Label
                                            text="{i18n>fechaSolicitud}"
                                            wrapping="true"
                                        />
                                    </table:label>
                                    <table:template>
                                        <VBox class="sapUiSmallMargin">
                                            <Text
                                                text="{
                                                            path: 'solicitudes>cust_fechaSol',
                                                            type: 'sap.ui.model.type.Date',
                                                            formatOptions: {
                                                                pattern: 'dd/MM/yyyy'
                                                            }
                                                        }"
                                            />
                                    
                                        </VBox>
                                    </table:template>
                                </table:Column>

                                <!-- Columna: Estado -->
                                <table:Column
                                    width="20%"
                                    sortProperty="cust_status"
                                    filterProperty="cust_status"
                                    showFilterMenuEntry="true"
                                    showSortMenuEntry="true"
                                >
                                    <table:label>
                                        <Label
                                            text="{i18n>estado}"
                                            wrapping="true"
                                        />
                                    </table:label>
                                    <table:template>
                                        <ObjectStatus
                                            text="{solicitudes>cust_status}"
                                            state="{
                                                        path: 'solicitudes>cust_status',
                                                        formatter: '.formatStatusState'
                                                    }"
                                            icon="{
                                                        path: 'solicitudes>cust_status',
                                                        formatter: '.formatStatusIcon'
                                                    }"
                                        />
                                    </table:template>
                                </table:Column>

                                <!-- Columna: Acciones -->
                                <table:Column
                                    width="10%"
                                    hAlign="Center"
                                    showFilterMenuEntry="false"
                                    showSortMenuEntry="false"
                                >
                                    <table:label>
                                        <Label
                                            text="{i18n>acciones}"
                                            wrapping="true"
                                        />
                                    </table:label>
                                    <table:template>
                                        <HBox
                                            justifyContent="Center"
                                            alignItems="Center"
                                        >
                                            <!-- Botón Visualizar -->
                                            <Button
                                                icon="sap-icon://detail-view"
                                                tooltip="{i18n>visualizar}"
                                                press="onVisualizarPress"
                                                type="Emphasized"
                                                class="sapUiTinyMarginEnd"
                                            />

                                            <!-- Botón Cancelar (solo si está en curso) -->
                                            <Button
                                                icon="sap-icon://cancel"
                                                tooltip="{i18n>cancelar}"
                                                press="onCancelarPress"
                                                type="Reject"
                                                visible="{
                                                            path: 'solicitudes>cust_status',
                                                            formatter: '.isStatusEnCurso'
                                                        }"
                                            />
                                        </HBox>
                                    </table:template>
                                </table:Column>
                            </table:columns>
                        </table:Table>
                    </VBox>
                </content>
            </Panel>
            <!-- </VBox> -->
        </content>
    </Page>
</mvc:View>