<mvc:View
    controllerName="com.inetum.missolicitudes.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:m="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:table="sap.ui.table"
    xmlns:html="http://www.w3.org/1999/xhtml"
    height="100%"
>
    <Page
        id="misSolicitudesPage"
        title=""
        showNavButton="false"
    >
        <content>       
            <Panel
                class="sapUiMediumMarginBottom"
                headerText="">

                <headerToolbar>
                    <Toolbar class="sapMTBTransparent-CTX">
                        <content>
                            <HBox alignItems="Center">
                                <core:Icon
                                    src="sap-icon://task"
                                    size="1.525rem"
                                    color="#0070f2"
                                    class="sapUiSmallMarginEnd" />
                                <Title
                                    text="{config>/titulo2}"
                                    level="H4" />
                            </HBox>
                        </content>
                    </Toolbar>
                </headerToolbar>

                <content>
                    <!-- <Panel class="sapUiNoContentPadding sapUiTinyMarginTop"> -->
                        <!-- Toolbar con controles superiores -->
                        <Toolbar class="sapUiMediumMarginBottom">
                            <content>
                                <!-- Búsqueda global -->
                                <SearchField
                                    id="searchField"
                                    placeholder="{i18n>searchPlaceholder}"
                                    search="onSearch"
                                    width="300px"
                                    class="sapUiMediumMarginEnd"
                                />

                                <ToolbarSpacer />

                                <!-- Contador de registros -->
                                <Text
                                    id="recordCount"
                                    text="{solicitudes>/solicitudes/totalCount} {i18n>totalRecords}"
                                    class="sapUiMediumMarginEnd"
                                />
                            </content>
                        </Toolbar>
                        
                        <!-- Tabla principal de solicitudes -->
                        <table:Table
                            id="solicitudesTable"
                            rows="{solicitudes>/solicitudes/results}"
                            selectionMode="Single"
                            enableSelectAll="true"
                            ariaLabelledBy="tableTitle"
                            rowSelectionChange="onRowSelectionChange"
                            alternateRowColors="true"
                            columnHeaderVisible="true"
                            enableColumnReordering="true"
                            showNoData="true"
                            threshold="100"
                            visibleRowCount="15"
                            enableBusyIndicator="true" >                          
                            
    
                            <table:columns>
                                <!-- Columna: Solicitud -->
                                <table:Column
                                    width="30%"
                                    sortProperty="cust_nombreSol"
                                    filterProperty="cust_nombreSol"
                                    showFilterMenuEntry="true"
                                    showSortMenuEntry="true"
                                >
                                    <table:label>
                                        <Label
                                            text="{i18n>solicitud}"
                                            wrapping="true"
                                        />
                                    </table:label>
                                    <table:template>                                       
                                            <FormattedText
                                                htmlText="&lt;strong&gt;{solicitudes>cust_nombreSol_defaultValue}&lt;/strong&gt;"
                                            />
                                    </table:template>
                                </table:Column>

                                <!-- Columna: Tipo de Solicitud -->
                                <table:Column
                                    width="20%"
                                    sortProperty="cust_nombreTSol"
                                    filterProperty="cust_nombreTSol"
                                    showFilterMenuEntry="true"
                                    showSortMenuEntry="true"
                                >
                                    <table:label>
                                        <Label text="{i18n>tipoSolicitud}" wrapping="true"/>
                                    </table:label>
                                    <table:template>
                                        <Text
                                            text="{solicitudes>cust_nombreTSol_defaultValue}"
                                            wrapping="true"
                                        />
                                    </table:template>
                                </table:Column>

                                <!-- Columna: Fecha de Solicitud -->
                                <table:Column
                                    width="20%"
                                    sortProperty="cust_fechaSol"
                                    filterProperty="cust_fechaSol"
                                    showFilterMenuEntry="true"
                                    showSortMenuEntry="true"
                                    hAlign="Center"
                                >
                                    <table:label>
                                        <Label
                                            text="{i18n>fechaSolicitud}"
                                            wrapping="true"
                                        />
                                    </table:label>
                                    <table:template>                                        
                                            <Text text="{path: 'solicitudes>cust_fechaSol', formatter: '.formatter.formatDateToYYYYMMDD'}" />                                        
                                    </table:template>
                                </table:Column>

                                <!-- Columna: Estado -->
                                <table:Column
                                    width="20%"
                                    sortProperty="cust_status"
                                    filterProperty="cust_status"
                                    showFilterMenuEntry="true"
                                    showSortMenuEntry="true"
                                >
                                    <table:label>
                                        <Label
                                            text="{i18n>estado}"
                                            wrapping="true"
                                        />
                                    </table:label>
                                    <table:template>
                                        <ObjectStatus
                                            text="{solicitudes>cust_status}"
                                            state="{
                                                        path: 'solicitudes>cust_status',
                                                        formatter: '.formatter.formatStatusState'
                                                    }"
                                            icon="{
                                                        path: 'solicitudes>cust_status',
                                                        formatter: '.formatter.formatStatusIcon'
                                                    }"
                                        />
                                    </table:template>
                                </table:Column>

                                <!-- Columna: Acciones -->
                                <table:Column
                                    width="10%"
                                    hAlign="Center"
                                    showFilterMenuEntry="false"
                                    showSortMenuEntry="false"
                                >
                                    <table:label>
                                        <Label
                                            text="{i18n>acciones}"
                                            wrapping="true"
                                        />
                                    </table:label>
                                    <table:template>
                                        <HBox
                                            justifyContent="Center"
                                            alignItems="Center"
                                        >
                                            <!-- Botón Visualizar -->
                                            <Button
                                                icon="sap-icon://search"
                                                tooltip="{i18n>visualizar}"
                                                press="onVisualizarPress"
                                                type="Emphasized"
                                                class="sapUiTinyMarginEnd"
                                            />

                                            <!-- Botón Cancelar (solo si está en curso) -->
                                            <Button
                                                icon="sap-icon://decline"
                                                tooltip="{i18n>cancelar}"
                                                press="onCancelarPress"
                                                type="Reject"
                                                visible="{
                                                            path: 'solicitudes>cust_status',
                                                            formatter: '.isStatusEnCurso'
                                                        }"
                                            />
                                        </HBox>
                                    </table:template>
                                </table:Column>
                            </table:columns>
                        </table:Table>                       
                    <!-- </Panel> -->
                </content>
            </Panel>
        </content>
    </Page>
</mvc:View>